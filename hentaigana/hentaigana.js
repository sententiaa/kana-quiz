var kana = {
	'hentaigana-a': {'ğ›€‚ğ›€…ğ›€ƒğ›€„':'a'},
	'hentaigana-i': {'ğ›€†ğ›€‡ğ›€ˆğ›€‰':'i'},
	'hentaigana-u': {'ğ›€Šğ›€‹ğ›€Œğ›€ğ›€':'u'},
	'hentaigana-e': {'ğ›€ğ›€ğ›€ğ›€‘ğ›€’ğ›€“':'e'},
	'hentaigana-o': {'ğ›€”ğ›€•ğ›€–':'o'},
	'hentaigana-ka': {'ğ›€—ğ›€˜ğ›€™ğ›€šğ›€›ğ›€¢ğ›€œğ›€ğ›€ğ›€Ÿğ›€ ğ›€¡':'ka'},
	'hentaigana-ki': {'ğ›€£ğ›€¤ğ›€¥ğ›€¦ğ›€»ğ›€§ğ›€¨ğ›€©ğ›€ª':'ki'},
	'hentaigana-ku': {'ğ›€«ğ›€¬ğ›€­ğ›€®ğ›€¯ğ›€°ğ›€±':'ku'},
	'hentaigana-ke': {'ğ›€³ğ›€²ğ›€¢ğ›€´ğ›€µğ›€¶ğ›€·':'ke'},
	'hentaigana-ko': {'ğ›€¸ğ›‚˜ğ›€¹ğ›€»ğ›€º':'ko'},
	'hentaigana-sa': {'ğ›€¼ğ›€½ğ›€¾ğ›€¿ğ›€ğ›ğ›‚ğ›ƒ':'sa'},
	'hentaigana-si': {'ğ›„ğ›…ğ›†ğ›‡ğ›ˆğ›‰':'shi'},
	'hentaigana-su': {'ğ›Šğ›‹ğ›Œğ›ğ›ğ›ğ›ğ›‘':'su'},
	'hentaigana-se': {'ğ›’ğ›“ğ›”ğ›•ğ›–':'se'},
	'hentaigana-so': {'ğ›—ğ›˜ğ›™ğ›šğ››ğ›œğ›':'so'},
	'hentaigana-ta': {'ğ›ğ›Ÿğ› ğ›¡':'ta'},
	'hentaigana-ti': {'ğ›¢ğ›£ğ›¤ğ›¥ğ›¦ğ›§ğ›¨':'chi'},
	'hentaigana-tu': {'ğ›©ğ›ªğ›«ğ›¬ğ›­':'tsu'},
	'hentaigana-te': {'ğ›®ğ›¯ğ›°ğ›±ğ›²ğ›³ğ›´ğ›µğ›¶ğ›‚':'te'},
	'hentaigana-to': {'ğ›·ğ›¸ğ›¹ğ›ºğ›»ğ›¼ğ›½ğ›­':'to'},

	'hentaigana-na': {'ğ›¾ğ›¿ğ›‚€ğ›‚ğ›‚‚ğ›‚ƒğ›‚„ğ›‚…ğ›‚†':'na'},
	'hentaigana-ni': {'ğ›‚‡ğ›‚ˆğ›‚‰ğ›‚Šğ›‚‹ğ›‚Œğ›‚ğ›‚':'ni'},
	'hentaigana-nu': {'ğ›‚ğ›‚ğ›‚‘':'nu'},
	'hentaigana-ne': {'ğ›‚’ğ›‚“ğ›‚”ğ›‚•ğ›‚–ğ›‚—ğ›‚˜':'ne'},
	'hentaigana-no': {'ğ›‚™ğ›‚šğ›‚›ğ›‚œğ›‚':'no'},
	'hentaigana-ha': {'ğ›‚ğ›‚Ÿğ›‚ ğ›‚¡ğ›‚¢ğ›‚£ğ›‚¤ğ›‚¥ğ›‚¦ğ›‚§ğ›‚¨':'ha'},
	'hentaigana-hi': {'ğ›‚©ğ›‚ªğ›‚«ğ›‚¬ğ›‚­ğ›‚®ğ›‚¯':'hi'},
	'hentaigana-hu': {'ğ›‚°ğ›‚±ğ›‚²':'hu'},
	'hentaigana-he': {'ğ›‚³ğ›‚´ğ›‚µğ›‚¶ğ›‚·ğ›‚¸ğ›‚¹':'he'},
	'hentaigana-ho': {'ğ›‚ºğ›‚»ğ›‚¼ğ›‚½ğ›‚¾ğ›‚¿ğ›ƒ€ğ›ƒ':'ho'},
	'hentaigana-ma': {'ğ›ƒ‚ğ›ƒƒğ›ƒ„ğ›ƒ…ğ›ƒ†ğ›ƒ‡ğ›ƒˆğ›ƒ–':'ma'},
	'hentaigana-mi': {'ğ›ƒ‰ğ›ƒŠğ›ƒ‹ğ›ƒŒğ›ƒğ›ƒğ›ƒ':'mi'},
	'hentaigana-mu': {'ğ›ƒğ›ƒ‘ğ›ƒ’ğ›ƒ“ğ›„ğ›„':'mu'},
	'hentaigana-me': {'ğ›ƒ”ğ›ƒ•ğ›ƒ–':'me'},
	'hentaigana-mo': {'ğ›ƒ—ğ›ƒ˜ğ›ƒ™ğ›ƒšğ›ƒ›ğ›ƒœğ›„ğ›„':'mo'},
	'hentaigana-ya': {'ğ›ƒğ›ƒğ›ƒŸğ›ƒ ğ›ƒ¡ğ›ƒ¢':'ya'},
	'hentaigana-yi': {'ğ›€†':'yi'},
	'hentaigana-yu': {'ğ›ƒ£ğ›ƒ¤ğ›ƒ¥ğ›ƒ¦':'yu'},
	'hentaigana-ye': {'ğ›€':'ye'},
	'hentaigana-yo': {'ğ›ƒ§ğ›ƒ¨ğ›ƒ©ğ›ƒªğ›ƒ«ğ›ƒ¬ğ›ƒ¢':'yo'},

	'hentaigana-ra': {'ğ›ƒ­ğ›ƒ®ğ›ƒ¯ğ›ƒ°ğ›½':'ra'},
	'hentaigana-ri': {'ğ›ƒ±ğ›ƒ²ğ›ƒ³ğ›ƒ´ğ›ƒµğ›ƒ¶ğ›ƒ·':'ri'},
	'hentaigana-ru': {'ğ›ƒ¸ğ›ƒ¹ğ›ƒºğ›ƒ»ğ›ƒ¼ğ›ƒ½':'ru'},
	'hentaigana-re': {'ğ›ƒ¾ğ›ƒ¿ğ›„€ğ›„':'re'},
	'hentaigana-ro': {'ğ›„‚ğ›„ƒğ›„„ğ›„…ğ›„†ğ›„‡':'ro'},
	'hentaigana-wa': {'ğ›„ˆğ›„‰ğ›„Šğ›„‹ğ›„Œ':'wa'},
	'hentaigana-wi': {'ğ›„ğ›„ğ›„ğ›„ğ›„‘':'wi'},
	'hentaigana-wu': {'ğ›„Ÿ':'wu'},
	'hentaigana-we': {'ğ›„’ğ›„“ğ›„”ğ›„•':'we'},
	'hentaigana-wo': {'ğ›„–ğ›„—ğ›„˜ğ›„™ğ›„šğ›„›ğ›„œğ›€…':'o'},
	'hentaigana-n': {'ğ›„ğ›„':'n'},
}

let source_characters = {
	'ã‚' : 'å®‰',
	'ğ›€‚' : 'å®‰',
	'ğ›€…' : 'æƒ¡',
	'ğ›€ƒ' : 'æ„›',
	'ğ›€„' : 'é˜¿',
	'ã‹' : 'åŠ ',
	'ğ›€—' : 'ä½³',
	'ğ›€˜' : 'åŠ ',
	'ğ›€™' : 'å¯',
	'ğ›€š' : 'å¯',
	'ğ›€›' : 'å˜‰',
	'ğ›€¢' : 'å®¶',
	'ğ›€œ' : 'æˆ‘',
	'ğ›€' : 'æ­Ÿ',
	'ğ›€' : 'è³€',
	'ğ›€Ÿ' : 'é–‘',
	'ğ›€ ' : 'é¦™',
	'ğ›€¡' : 'é§•',
	'ã•' : 'å·¦',
	'ğ›€¼' : 'ä¹',
	'ğ›€½' : 'ä½',
	'ğ›€¾' : 'ä½',
	'ğ›€¿' : 'å·¦',
	'ğ›€' : 'å·®',
	'ğ›' : 'æ•£',
	'ğ›‚' : 'æ–œ',
	'ğ›ƒ' : 'æ²™',
	'ãŸ' : 'å¤ª',
	'ğ›' : 'å ‚',
	'ğ›Ÿ' : 'å¤š',
	'ğ› ' : 'å¤š',
	'ğ›¡' : 'ç•¶',
	'ãª' : 'å¥ˆ',
	'ğ›¾' : 'å—',
	'ğ›¿' : 'å',
	'ğ›‚€' : 'å¥ˆ',
	'ğ›‚' : 'å¥ˆ',
	'ğ›‚‚' : 'å¥ˆ',
	'ğ›‚ƒ' : 'èœ',
	'ğ›‚„' : 'é‚£',
	'ğ›‚…' : 'é‚£',
	'ğ›‚†' : 'é›£',
	'ã¯' : 'æ³¢',
	'ğ›‚' : 'å…«',
	'ğ›‚Ÿ' : 'åŠ',
	'ğ›‚ ' : 'å©†',
	'ğ›‚¡' : 'æ³¢',
	'ğ›‚¢' : 'ç›¤',
	'ğ›‚£' : 'ç›¤',
	'ğ›‚¤' : 'ç ´',
	'ğ›‚¥' : 'è€…',
	'ğ›‚¦' : 'è€…',
	'ğ›‚§' : 'è‘‰',
	'ğ›‚¨' : 'é —',
	'ã¾' : 'æœ«',
	'ğ›ƒ‚' : 'ä¸‡',
	'ğ›ƒƒ' : 'æœ«',
	'ğ›ƒ„' : 'æœ«',
	'ğ›ƒ…' : 'æ»¿',
	'ğ›ƒ†' : 'æ»¿',
	'ğ›ƒ‡' : 'è¬',
	'ğ›ƒˆ' : 'éº»',
	'ğ›ƒ–' : 'é¦¬',
	'ã‚„' : 'ä¹Ÿ',
	'ğ›ƒ' : 'ä¹Ÿ',
	'ğ›ƒ' : 'ä¹Ÿ',
	'ğ›ƒŸ' : 'å±‹',
	'ğ›ƒ ' : 'è€¶',
	'ğ›ƒ¡' : 'è€¶',
	'ğ›ƒ¢' : 'å¤œ',
	'ã‚‰' : 'è‰¯',
	'ğ›ƒ­' : 'ç¾…',
	'ğ›ƒ®' : 'è‰¯',
	'ğ›ƒ¯' : 'è‰¯',
	'ğ›ƒ°' : 'è‰¯',
	'ğ›½' : 'ç­‰',
	'ã‚' : 'å’Œ',
	'ğ›„ˆ' : 'å€­',
	'ğ›„‰' : 'å’Œ',
	'ğ›„Š' : 'å’Œ',
	'ğ›„‹' : 'ç‹',
	'ğ›„Œ' : 'ç‹',
	'ã‚“' : 'æ— ',
	'ğ›„' : 'æ— ',
	'ğ›„' : 'æ— ',
	'ã„' : 'ä»¥',
	'ğ›€†' : 'ä»¥',
	'ğ›€‡' : 'ä¼Š',
	'ğ›€ˆ' : 'æ„',
	'ğ›€‰' : 'ç§»',
	'ã' : 'å¹¾',
	'ğ›€£' : 'å–œ',
	'ğ›€¤' : 'å¹¾',
	'ğ›€¥' : 'å¹¾',
	'ğ›€¦' : 'æ”¯',
	'ğ›€»' : 'æœŸ',
	'ğ›€§' : 'æœ¨',
	'ğ›€¨' : 'ç¥ˆ',
	'ğ›€©' : 'è²´',
	'ğ›€ª' : 'èµ·',
	'ã—' : 'ä¹‹',
	'ğ›„' : 'ä¹‹',
	'ğ›…' : 'ä¹‹',
	'ğ›†' : 'äº‹',
	'ğ›‡' : 'å››',
	'ğ›ˆ' : 'å¿—',
	'ğ›‰' : 'æ–°',
	'ã¡' : 'çŸ¥',
	'ğ›¢' : 'åƒ',
	'ğ›£' : 'åœ°',
	'ğ›¤' : 'æ™º',
	'ğ›¥' : 'çŸ¥',
	'ğ›¦' : 'çŸ¥',
	'ğ›§' : 'è‡´',
	'ğ›¨' : 'é²',
	'ã«' : 'ä»',
	'ğ›‚‡' : 'ä¸¹',
	'ğ›‚ˆ' : 'äºŒ',
	'ğ›‚‰' : 'ä»',
	'ğ›‚Š' : 'å…’',
	'ğ›‚‹' : 'çˆ¾',
	'ğ›‚Œ' : 'çˆ¾',
	'ğ›‚' : 'è€³',
	'ğ›‚' : 'è€Œ',
	'ã²' : 'æ¯”',
	'ğ›‚©' : 'æ‚²',
	'ğ›‚ª' : 'æ—¥',
	'ğ›‚«' : 'æ¯”',
	'ğ›‚¬' : 'é¿',
	'ğ›‚­' : 'é',
	'ğ›‚®' : 'é£›',
	'ğ›‚¯' : 'é£›',
	'ã¿' : 'ç¾',
	'ğ›ƒ‰' : 'ä¸‰',
	'ğ›ƒŠ' : 'å¾®',
	'ğ›ƒ‹' : 'ç¾',
	'ğ›ƒŒ' : 'ç¾',
	'ğ›ƒ' : 'ç¾',
	'ğ›ƒ' : 'è¦‹',
	'ğ›ƒ' : 'èº«',
	'ğ›€†' : 'ä»¥',
	'ğ›€†' : 'ä»¥',
	'ã‚Š' : 'åˆ©',
	'ğ›ƒ±' : 'åˆ©',
	'ğ›ƒ²' : 'åˆ©',
	'ğ›ƒ³' : 'æ',
	'ğ›ƒ´' : 'æ¢¨',
	'ğ›ƒµ' : 'ç†',
	'ğ›ƒ¶' : 'é‡Œ',
	'ğ›ƒ·' : 'é›¢',
	'ã‚' : 'ç‚º',
	'ğ›„' : 'äº•',
	'ğ›„' : 'äº•',
	'ğ›„' : 'å±…',
	'ğ›„' : 'çˆ²',
	'ğ›„‘' : 'éº',
	'ã†' : 'å®‡',
	'ğ›€Š' : 'å®‡',
	'ğ›€‹' : 'å®‡',
	'ğ›€Œ' : 'æ†‚',
	'ğ›€' : 'æœ‰',
	'ğ›€' : 'é›²',
	'ã' : 'ä¹…',
	'ğ›€«' : 'ä¹…',
	'ğ›€¬' : 'ä¹…',
	'ğ›€­' : 'ä¹',
	'ğ›€®' : 'ä¾›',
	'ğ›€¯' : 'å€¶',
	'ğ›€°' : 'å…·',
	'ğ›€±' : 'æ±‚',
	'ã™' : 'å¯¸',
	'ğ›Š' : 'å—',
	'ğ›‹' : 'å£½',
	'ğ›Œ' : 'æ•¸',
	'ğ›' : 'æ•¸',
	'ğ›' : 'æ˜¥',
	'ğ›' : 'æ˜¥',
	'ğ›' : 'é ˆ',
	'ğ›‘' : 'é ˆ',
	'ã¤' : 'å·',
	'ğ›©' : 'å·',
	'ğ›ª' : 'å·',
	'ğ›«' : 'æ´¥',
	'ğ›¬' : 'éƒ½',
	'ğ›­' : 'å¾’',
	'ã¬' : 'å¥´',
	'ğ›‚' : 'åŠª',
	'ğ›‚' : 'å¥´',
	'ğ›‚‘' : 'æ€’',
	'ãµ' : 'ä¸',
	'ğ›‚°' : 'ä¸',
	'ğ›‚±' : 'å©¦',
	'ğ›‚²' : 'å¸ƒ',
	'ã‚€' : 'æ­¦',
	'ğ›ƒ' : 'æ­¦',
	'ğ›ƒ‘' : 'ç„¡',
	'ğ›ƒ’' : 'ç‰Ÿ',
	'ğ›ƒ“' : 'èˆ',
	'ğ›„' : 'æ— ',
	'ğ›„' : 'æ— ',
	'ã‚†' : 'ç”±',
	'ğ›ƒ£' : 'æ¸¸',
	'ğ›ƒ¤' : 'ç”±',
	'ğ›ƒ¥' : 'ç”±',
	'ğ›ƒ¦' : 'éŠ',
	'ã‚‹' : 'ç•™',
	'ğ›ƒ¸' : 'æµ',
	'ğ›ƒ¹' : 'ç•™',
	'ğ›ƒº' : 'ç•™',
	'ğ›ƒ»' : 'ç•™',
	'ğ›ƒ¼' : 'ç´¯',
	'ğ›ƒ½' : 'é¡',
	'ğ›„Ÿ' : 'æ±™',
	'ãˆ' : 'è¡£',
	'ğ›€' : 'æ±Ÿ',
	'ğ›€' : 'ç›ˆ',
	'ğ›€' : 'ç¸',
	'ğ›€‘' : 'è¡£',
	'ğ›€’' : 'è¡£',
	'ğ›€“' : 'è¦',
	'ã‘' : 'è¨ˆ',
	'ğ›€³' : 'ä»‹',
	'ğ›€²' : 'ä»‹',
	'ğ›€¢' : 'å®¶',
	'ğ›€´' : 'å¸Œ',
	'ğ›€µ' : 'æ°£',
	'ğ›€¶' : 'è¨ˆ',
	'ğ›€·' : 'é£',
	'ã›' : 'ä¸–',
	'ğ›’' : 'ä¸–',
	'ğ›“' : 'ä¸–',
	'ğ›”' : 'ä¸–',
	'ğ›•' : 'å‹¢',
	'ğ›–' : 'è²',
	'ã¦' : 'å¤©',
	'ğ›®' : 'äº­',
	'ğ›¯' : 'ä½',
	'ğ›°' : 'å‚³',
	'ğ›±' : 'å¤©',
	'ğ›²' : 'å¤©',
	'ğ›³' : 'å¤©',
	'ğ›´' : 'å¸',
	'ğ›µ' : 'å¼–',
	'ğ›¶' : 'è½‰',
	'ğ›‚' : 'è€Œ',
	'ã­' : 'ç¥¢',
	'ğ›‚’' : 'å¹´',
	'ğ›‚“' : 'å¹´',
	'ğ›‚”' : 'å¹´',
	'ğ›‚•' : 'æ ¹',
	'ğ›‚–' : 'ç†±',
	'ğ›‚—' : 'ç¦°',
	'ğ›‚˜' : 'å­',
	'ã¸' : 'éƒ¨',
	'ğ›‚³' : 'å€',
	'ğ›‚´' : 'å¼Š',
	'ğ›‚µ' : 'å¼Š',
	'ğ›‚¶' : 'é',
	'ğ›‚·' : 'é‚Š',
	'ğ›‚¸' : 'é‚Š',
	'ğ›‚¹' : 'éƒ¨',
	'ã‚' : 'å¥³',
	'ğ›ƒ”' : 'å…',
	'ğ›ƒ•' : 'é¢',
	'ğ›ƒ–' : 'é¦¬',
	'ğ›€' : 'æ±Ÿ',
	'ğ›€' : 'æ±Ÿ',
	'ã‚Œ' : 'ç¤¼',
	'ğ›ƒ¾' : 'ç¦®',
	'ğ›ƒ¿' : 'ç¤¼',
	'ğ›„€' : 'é€£',
	'ğ›„' : 'éº—',
	'ã‚‘' : 'æµ',
	'ğ›„’' : 'æƒ ',
	'ğ›„“' : 'è¡',
	'ğ›„”' : 'è¡',
	'ğ›„•' : 'è¡',
	'ãŠ' : 'æ–¼',
	'ğ›€”' : 'æ–¼',
	'ğ›€•' : 'æ–¼',
	'ğ›€–' : 'éš±',
	'ã“' : 'å·±',
	'ğ›€¸' : 'å¤',
	'ğ›‚˜' : 'å­',
	'ğ›€¹' : 'æ•…',
	'ğ›€»' : 'æœŸ',
	'ğ›€º' : 'è¨±',
	'ã' : 'æ›¾',
	'ğ›—' : 'æ‰€',
	'ğ›˜' : 'æ‰€',
	'ğ›™' : 'æ›¾',
	'ğ›š' : 'æ›¾',
	'ğ››' : 'æ¥š',
	'ğ›œ' : 'è˜‡',
	'ğ›' : 'è™•',
	'ã¨' : 'æ­¢',
	'ğ›·' : 'åœŸ',
	'ğ›¸' : 'åº¦',
	'ğ›¹' : 'æ±',
	'ğ›º' : 'ç™»',
	'ğ›»' : 'ç™»',
	'ğ›¼' : 'ç ¥',
	'ğ›½' : 'ç­‰',
	'ğ›­' : 'å¾’',
	'ã®' : 'ä¹ƒ',
	'ğ›‚™' : 'ä¹ƒ',
	'ğ›‚š' : 'æ¿ƒ',
	'ğ›‚›' : 'èƒ½',
	'ğ›‚œ' : 'èƒ½',
	'ğ›‚' : 'è¾²',
	'ã»' : 'ä¿',
	'ğ›‚º' : 'ä¿',
	'ğ›‚»' : 'ä¿',
	'ğ›‚¼' : 'å ±',
	'ğ›‚½' : 'å¥‰',
	'ğ›‚¾' : 'å¯¶',
	'ğ›‚¿' : 'æœ¬',
	'ğ›ƒ€' : 'æœ¬',
	'ğ›ƒ' : 'è±Š',
	'ã‚‚' : 'æ¯›',
	'ğ›ƒ—' : 'æ¯',
	'ğ›ƒ˜' : 'æ¯›',
	'ğ›ƒ™' : 'æ¯›',
	'ğ›ƒš' : 'æ¯›',
	'ğ›ƒ›' : 'èŒ‚',
	'ğ›ƒœ' : 'è£³',
	'ğ›„' : 'æ— ',
	'ğ›„' : 'æ— ',
	'ã‚ˆ' : 'ä¸',
	'ğ›ƒ§' : 'ä»£',
	'ğ›ƒ¨' : 'ä½™',
	'ğ›ƒ©' : 'èˆ‡',
	'ğ›ƒª' : 'èˆ‡',
	'ğ›ƒ«' : 'èˆ‡',
	'ğ›ƒ¬' : 'é¤˜',
	'ğ›ƒ¢' : 'å¤œ',
	'ã‚' : 'å‘‚',
	'ğ›„‚' : 'å‘‚',
	'ğ›„ƒ' : 'å‘‚',
	'ğ›„„' : 'å©',
	'ğ›„…' : 'æ¨“',
	'ğ›„†' : 'è·¯',
	'ğ›„‡' : 'éœ²',
	'ã‚’' : 'é ',
	'ğ›„–' : 'ä¹',
	'ğ›„—' : 'ä¹',
	'ğ›„˜' : 'å°¾',
	'ğ›„™' : 'ç·’',
	'ğ›„š' : 'è¶Š',
	'ğ›„›' : 'é ',
	'ğ›„œ' : 'é ',
	'ğ›€…' : 'æƒ¡',
}

var active = [];
var shuffled = [];

var replacements = {
	'o': ['wo'],
	'chi': ['ci'],
	'shi': ['si'],
	'tsu': ['tu'],
	'zu': ['du'],
	'ji': ['di', 'zi'],
	'fu': ['hu'],
	'ja': ['dya'],
	'jo': ['dyo'],
	'ju': ['dyu']
};

var cur_kana;
var cur_reading;

var total_answered = 0;
var total_correct = 0;

function save_settings() {
	inputs = document.getElementsByTagName('input');
	for (i = 0; i < inputs.length; i++) {
		if (inputs[i].type == 'checkbox') {
			checked = inputs[i].checked ? '1' : '0';
			localStorage.setItem('kana_' + inputs[i].id, checked);
		}
	}

	collect();
}

function load_settings() {
	inputs = document.getElementsByTagName('input');
	for (i = 0; i < inputs.length; i++) {
		if (inputs[i].type == 'checkbox') {
			var setting = localStorage.getItem('kana_' + inputs[i].id);
			if (setting === '1') {
				inputs[i].checked = true;
			} else if (setting === '0') {
				inputs[i].checked = false;
			}
		}
	}

	collect();
}

function check(set) {
	var trs = document.getElementsByClassName(set);
	for (i = 0; i < trs.length; i++) {
		var tds = trs[i].children;
		for (x = 0; x < tds.length; x++) {
			if (tds[x].children[0].id != 'KOI-WIN') {
				tds[x].children[0].checked = true;
			}
		}
	}
	save_settings();
}

function uncheck(set) {
	var trs = document.getElementsByClassName(set);
	for (i = 0; i < trs.length; i++) {
		var tds = trs[i].children;
		for (x = 0; x < tds.length; x++) {
			tds[x].children[0].checked = false;
		}
	}
	save_settings();
}

function shuffle(orig_array) {
	var array = orig_array.slice(0);
	var currentIndex = array.length, temporaryValue, randomIndex;

	while (0 !== currentIndex) {

		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;

		temporaryValue = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = temporaryValue;
	}

	return array;
}

function collect() {
	kanacheck = document.getElementsByClassName('kanacheck');
	active = [];
	shuffled = [];
	for (i = 0; i < kanacheck.length; i++) {
		cur = kanacheck[i];
		if (cur.checked == true) {
			for (let key in kana[cur.id]) {
				let key_array = Array.from(key);
				for (let j = 0; j < key_array.length; j++) {
					active.push([key_array[j], kana[cur.id][key]]);
				}
			}
		}
	}
}

function show_kana() {
	wrong = false;
	document.getElementById('input_box').value = '';

	if (active.length == 0) {
		document.getElementById('hentaigana-a').checked = true;
		save_settings();
	}

	if (total_answered > 0) {
		document.getElementById('count').innerHTML = total_correct + '/' + total_answered;
		document.getElementById('message').innerHTML = '&nbsp;';
	}

	if (shuffled.length == 0) {
		shuffled = shuffle(active);
	}

	if (cur_kana && shuffled[0][0] == cur_kana) {
		shuffled.shift();
	}

	cur_kana = shuffled[0][0];
	cur_reading = shuffled[0][1];

	shuffled.shift();

	document.getElementById('kana').innerHTML = cur_kana;

	document.getElementById('answer').innerHTML = cur_reading + " (" + source_characters[cur_kana] + ")";
}

function check_answer() {
	answer = document.getElementById('input_box').value.toLowerCase();
	if (!answer) {
		answer = 'x';
	}

	chars = answer.split('');

	possible = [cur_reading];
	if (cur_reading in replacements) {
		possible = possible.concat(replacements[cur_reading]);
	}

	for (i = 0; i < chars.length; i++) {
		var err = true;

		for (x = 0; x < possible.length; x++) {
			if (chars[i] == possible[x].charAt(i)) {
				err = false;
			}
			if (answer == possible[x]) {
				answer = cur_reading;
			}
		}

		if (err) {
			break;
		}
	}

	if (err) {
		wrong = true;
		document.getElementById('message').innerHTML = '<span id="wrong">' + cur_kana + ' = ' + cur_reading + '</span>';
	}

	if (answer == cur_reading) {
		total_answered += 1;
		if (!wrong) {
			total_correct += 1;
		}
		show_kana();
	}
}

function force_next() {
	if (shuffled.length > 3) {
		shuffled.splice(3, 0, [cur_kana, cur_reading]);
	}
	if (shuffled.length > 13) {
		shuffled.splice(13, 0, [cur_kana, cur_reading]);
	}
	total_answered += 1;

	show_kana();
}

function show_answer() {
	document.getElementById('answer').style.visibility = 'visible';
}

function hide_answer() {
	document.getElementById('answer').style.visibility = 'hidden';
}

function play_sound() {
	var audio = new Audio('../audio/' + cur_reading + '.mp3');
	audio.play();
	document.getElementById('input_box').focus();
}

function play_other(file) {
	var audio = new Audio('../audio/' + file + '.mp3');
	audio.play();
}

function stroke_order() {
	document.getElementById('kana').innerHTML = '<img src="stroke/' + cur_kana + '.gif" id="stroke" />';
	document.getElementById('input_box').focus();
}


onload = function () {
	load_settings();

	inputs = document.getElementsByTagName('input');
	for (i = 0; i < inputs.length; i++) {
		if (inputs[i].type == 'checkbox') {
			inputs[i].onclick = save_settings;
			inputs[i].onpropertychange = inputs[i].oninput;
		}
	}

	show_kana();

	var kana_div = document.getElementById('kana');
	kana_div.onmouseover = show_answer;
	kana_div.onmouseout = hide_answer;

	var answer_input = document.getElementById('input_box');
	answer_input.focus();
	answer_input.oninput = check_answer;
	answer_input.onpropertychange = answer_input.oninput;

	document.body.onkeydown = function (e) {
		let focus_keys = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
		let submit_keys = [" ", "Enter"];
		if ((focus_keys.includes(e.key) || submit_keys.includes(e.key)) && !(e.ctrlKey || e.altKey || e.metaKey)) {
			document.getElementById('input_box').focus();
		}

		if (submit_keys.includes(e.key)) {
			e.preventDefault();
			if (!wrong) {
				check_answer();
			} else {
				force_next();
			}
		}
	}
}